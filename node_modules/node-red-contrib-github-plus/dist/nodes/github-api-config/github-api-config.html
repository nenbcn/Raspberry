<script type="text/javascript">
(function () {
    'use strict';

    var githubApiConfigCredentials = {
        privKey: { type: "text" },
    };

    RED.nodes.registerType("github-api-config", {
        category: "config",
        defaults: {
            appId: { value: "", validate: RED.validators.number(), required: true },
            instId: { value: "", validate: RED.validators.number(), required: true },
            ua: { value: "" },
            name: { value: "" },
        },
        credentials: githubApiConfigCredentials,
        label: function () {
            return this.name || "GitHub API client config";
        },
        oneditprepare: function () {
            $("#ghPemFile").on("change", function (evt) {
                var files = evt.target.files;
                if (!files || files.length < 1) {
                    return;
                }
                var file = files[0];
                var reader = new FileReader();
                reader.onload = function (_evt) {
                    var _a;
                    $("#ghPemFile").val("");
                    var text = ((_a = reader.result) === null || _a === void 0 ? void 0 : _a.toString().trim()) || "";
                    if (text.length < 100 ||
                        text.length > 10000 ||
                        !text.startsWith("-----BEGIN RSA PRIVATE KEY-----") ||
                        !text.endsWith("-----END RSA PRIVATE KEY-----")) {
                        RED.notifications.notify("Invalid key file", "error");
                        return;
                    }
                    $("#node-config-input-privKey").val(text);
                };
                reader.readAsText(file);
            });
        },
    });

}());
</script>
<script type="text/html" data-template-name="github-api-config">
  <div class="form-row">
    <label for="node-config-input-appId"><i class="fa fa-github"></i> App ID</label>
    <input type="text" id="node-config-input-appId">
  </div>

  <div class="form-row">
    <div>
      <label for="node-config-input-privKey"><i class="fa fa-key"></i> Private Key</label>
      <textarea id="node-config-input-privKey" rows="4" style="width:70%; resize:vertical" placeholder="-----BEGIN RSA PRIVATE KEY-----&#10;...&#10;-----END RSA PRIVATE KEY-----"></textarea>
    </div>
    <div>
      <label></label>
      <input type="file" id="ghPemFile" accept=".pem" />
    </div>
  </div>

  <div class="form-row">
    <label for="node-config-input-instId"><i class="fa fa-github-square"></i> Inst ID</label>
    <input type="text" id="node-config-input-instId">
  </div>

  <div class="form-row">
    <label for="node-config-input-ua"><i class="fa fa-id-badge"></i> User-Agent</label>
    <input type="text" id="node-config-input-ua">
  </div>

  <hr/>

  <div class="form-row">
    <label for="node-config-input-name"><i class="fa fa-tag"></i> Name</label>
    <input type="text" id="node-config-input-name" placeholder="Name">
  </div>
</script>

<script type="text/html" data-help-name="github-api-config">
  <p>Configuration node for GitHub API client.</p>

  <h3>Details</h3>
  <p>
    Enter App Id and Private Key of your GitHub App, and Inst Id of the app installation to make API requests with.
  </p>

  <h3>References</h3>
  <ul>
    <li>
      <a href="https://github.com/redbtc/node-red-contrib-github-plus#configuration">Configuration</a> - docs
      on configuring GitHub API client
    </li>
    <li>
      <a href="https://github.com/redbtc/node-red-contrib-github-plus#making-rest-api-requests">Making REST API Requests</a> -
      docs on making REST API requests with GitHub REST API Node
    </li>
    <li>
      <a href="https://github.com/redbtc/node-red-contrib-github-plus#handling-incoming-webhook-payloads">Handling Incoming Webhook Payloads</a> -
      docs on listening for GitHub events and receiving payload with GitHub Webhook Node
    </li>
    <li>
      <a href="https://github.com/redbtc/node-red-contrib-github-plus#examples">Example Flows</a> - examples made with GitHub nodes
    </li>
    <li>
      <a
        href="https://docs.github.com/en/free-pro-team@latest/rest/overview/endpoints-available-for-github-apps"
        rel="noreferrer noopener"
        >REST Endpoints available for GitHub Apps</a
      >
      - list of all REST endpoints your GitHub app can make requests to
    </li>
    <li>
      <a
        href="https://docs.github.com/en/free-pro-team@latest/rest/reference"
        rel="noreferrer noopener"
        >REST API Reference</a
      >
      - documentation to learn about the resources available in the GitHub REST API
    </li>
    <li>
      <a
        href="https://docs.github.com/en/free-pro-team@latest/rest/overview/media-types"
        rel="noreferrer noopener"
        >REST Media Types</a
      >
      - documentation to learn about custom media types in the GitHub REST API
    </li>
    <li>
      <a
        href="https://docs.github.com/en/free-pro-team@latest/developers/webhooks-and-events/webhook-events-and-payloads"
        rel="noreferrer noopener"
        >Webhook events and payloads</a
      >
      - documentation on webhook events and payloads
    </li>
    <li>
      <a href="https://github.com/redbtc/node-red-contrib-github-plus">GitHub</a> -
      project home on GitHub
    </li>
  </ul>
</script>
